{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gitgammon.github.io/schemas/state.json",
  "title": "GitGammon Game State",
  "description": "Authoritative game state for a GitGammon table",
  "type": "object",
  "required": [
    "turn",
    "activePlayer",
    "dice",
    "diceUsed",
    "board",
    "bar",
    "home",
    "lastMove",
    "status",
    "winner",
    "players",
    "messages",
    "updatedAt"
  ],
  "properties": {
    "turn": {
      "type": "integer",
      "minimum": 1,
      "description": "Current turn number, 1-indexed"
    },
    "activePlayer": {
      "type": "string",
      "enum": ["white", "black"],
      "description": "Player whose turn it is to move"
    },
    "dice": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 1,
        "maximum": 6
      },
      "minItems": 2,
      "maxItems": 4,
      "description": "Current dice values (4 items when doubles rolled)"
    },
    "diceUsed": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 1,
        "maximum": 6
      },
      "maxItems": 4,
      "description": "Dice values already used this turn"
    },
    "board": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": -15,
        "maximum": 15
      },
      "minItems": 24,
      "maxItems": 24,
      "description": "24-element array, positive=white, negative=black, index 0=point 1"
    },
    "bar": {
      "type": "object",
      "required": ["white", "black"],
      "properties": {
        "white": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "black": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        }
      },
      "additionalProperties": false,
      "description": "Pieces on the bar waiting to re-enter"
    },
    "home": {
      "type": "object",
      "required": ["white", "black"],
      "properties": {
        "white": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "black": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        }
      },
      "additionalProperties": false,
      "description": "Pieces successfully borne off"
    },
    "lastMove": {
      "oneOf": [
        { "type": "null" },
        {
          "type": "object",
          "required": ["sequence", "player", "file"],
          "properties": {
            "sequence": {
              "type": "integer",
              "minimum": 1,
              "description": "Move sequence number"
            },
            "player": {
              "type": "string",
              "enum": ["white", "black"]
            },
            "file": {
              "type": "string",
              "pattern": "^[0-9]{4}-(white|black)-[a-f0-9]+\\.json$",
              "description": "Filename of the move file"
            }
          },
          "additionalProperties": false
        }
      ],
      "description": "Reference to the last applied move, null for initial state"
    },
    "status": {
      "type": "string",
      "enum": ["playing", "completed"],
      "description": "Current game status"
    },
    "winner": {
      "oneOf": [
        { "type": "null" },
        { "type": "string", "enum": ["white", "black"] }
      ],
      "description": "Winner of the game, null while playing"
    },
    "players": {
      "type": "object",
      "required": ["white", "black"],
      "properties": {
        "white": {
          "type": "string",
          "minLength": 1,
          "description": "GitHub username of white player"
        },
        "black": {
          "type": "string",
          "minLength": 1,
          "description": "GitHub username of black player"
        }
      },
      "additionalProperties": false,
      "description": "Player identity mapping"
    },
    "messages": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type", "text", "timestamp"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["error", "info", "warning"]
          },
          "text": {
            "type": "string",
            "minLength": 1
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        },
        "additionalProperties": false
      },
      "description": "System messages and error notifications"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last state update"
    }
  },
  "additionalProperties": false
}
